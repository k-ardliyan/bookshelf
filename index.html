<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Bookshelf App</title>
</head>

<body>
    <header class="text-center py-3 bg-light">
        <h2>Bookshelf</h2>
    </header>
    <section class="container my-3">
        <div class="row justify-content-between">
            <div class="col-6 col-sm-auto">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">
                    Tambah Buku
                </button>
            </div>
            <div class="col-6 col-sm-auto">
                <form class="d-flex" role="search" id="searchBook">
                    <input id="searchBookTitle" class="form-control me-2" type="search" placeholder="Cari Buku"
                        aria-label="Search">
                    <button id="searchSubmit" class="btn btn-outline-success" type="submit">Cari</button>
                </form>
            </div>
        </div>
    </section>

    <section class="container">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="row mb-3 align-items-center justify-content-between">
                            <div class="col-6 col-sm-auto">
                                <h3>Rak Buku</h3>
                            </div>
                            <div class="col-6 col-sm-auto">
                                <div class="form-floating">
                                    <select class="form-select" id="filterBook">
                                        <option value="" selected>Semua</option>
                                        <option value="false">Belum Dibaca</option>
                                        <option value="true">Selesai Dibaca</option>
                                    </select>
                                    <label for="filterBook">Filter Buku</label>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3" id="bookList">
                            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                                <div class="card">
                                    <div class="card-body shadow">
                                        <button type="button" class="btn-close float-end" aria-label="Close"></button>
                                        <div class="form-check form-switch d-flex mb-2">
                                            <input class="form-check-input" type="checkbox" role="switch"
                                                id="isComplete">
                                            <label class="badge bg-warning ms-2 rounded-4" for="isComplete">Belum
                                                Dibaca</label>
                                        </div>
                                        <h4>Laskar Pelangi</h4>
                                        <p class="mb-0">Penulis: Andrea Hirate</p>
                                        <p class="mb-0">Tahun: 2012</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                                <div class="card">
                                    <div class="card-body shadow">
                                        <button type="button" class="btn-close float-end" aria-label="Close"></button>
                                        <div class="form-check form-switch d-flex mb-2">
                                            <input class="form-check-input" type="checkbox" role="switch"
                                                id="isComplete" checked>
                                            <label class="badge bg-success ms-2 rounded-4" for="isComplete">Selesai
                                                Dibaca</label>
                                        </div>
                                        <h4>Laskar Pelangi</h4>
                                        <p class="mb-0">Penulis: Andrea Hirate</p>
                                        <p class="mb-0">Tahun: 2012</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Add Book -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addModalLabel">Masukkan Buku Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="inputBook">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="inputBookTitle" placeholder="Nama Buku"
                                required>
                            <label for="inputBookTitle">Judul</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="inputBookAuthor" placeholder="Nama Penulis"
                                required>
                            <label for="inputBookAuthor">Penulis</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="inputBookYear" placeholder="Tahun Buku Keluar"
                                required>
                            <label for="inputBookYear">Tahun</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="inputBookIsComplete">
                            <label class="form-check-label" for="inputBookIsComplete">
                                Buku Selesai Dibaca
                            </label>
                        </div>
                        <button type="submit" id="bookSubmit" class="btn btn-primary w-100 mt-3">Simpan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (() => {
            let bookList = [];

            // store book from form
            function storeBook(e) {
                e.preventDefault();
                const title = document.querySelector('#inputBookTitle'),
                    author = document.querySelector('#inputBookAuthor'),
                    year = document.querySelector('#inputBookYear'),
                    isComplete = document.querySelector('#inputBookIsComplete'),
                    book = {
                        id: +new Date(),
                        title: title.value,
                        author: author.value,
                        year: year.value,
                        isComplete: isComplete.checked
                    };
                bookList.push(book);
                document.dispatchEvent(new Event('bookChanged'));
                console.log(bookList);
            }

            // filter book
            function filterBook(filter) {
                let filteredBook = bookList.filter(book => {
                    return book.isComplete === filter;
                });
                document.dispatchEvent(new Event('bookChanged'));
            }

            // serch book
            function searchBook(search) {
                let filteredBook = bookList.filter(book => {
                    return book.title.toLowerCase().includes(search.toLowerCase());
                });
                document.dispatchEvent(new Event('bookChanged'));
            }

            // show book list
            function showBookList(bookList) {
                let bookListElement = document.getElementById('bookList');
                bookListElement.innerHTML = '';
                bookList.forEach(book => {
                    let bookElement = document.createElement('div');
                    bookElement.className = 'col-12 col-sm-6 col-md-4 col-lg-3';
                    bookElement.innerHTML = `
                    <div class="card">
                        <div class="card-body shadow">
                            <button type="button" class="btn-close float-end" aria-label="Close"></button>
                            <div class="form-check form-switch d-flex mb-2">
                                <input class="form-check-input" type="checkbox" role="switch" id="isComplete" ${book.isComplete ? 'checked' : ''}>
                                <label class="badge bg-${book.isComplete ? 'success' : 'warning'} ms-2 rounded-4" for="isComplete">${book.isComplete ? 'Selesai Dibaca' : 'Belum Dibaca'}</label>
                            </div>
                            <h4>${book.title}</h4>
                            <p class="mb-0">Penulis: ${book.author}</p>
                            <p class="mb-0">Tahun: ${book.year}</p>
                        </div>
                    </div>
                    `;
                    bookListElement.appendChild(bookElement);
                });
            }

            // function local storage
            function storeLocalStorage() {
                ! function (bookList) {
                    localStorage.setItem('bookList', JSON.stringify(bookList));
                }(bookList), showBookList(bookList);
            }

            window.addEventListener('load', (function () {
                bookList = JSON.parse(localStorage.getItem('bookList'));
                const inputBook = document.querySelector('#inputBook'),
                    searchBook = document.querySelector('#searchBook'),
                    filterBook = document.querySelector('#filterBook');

                // add book
                inputBook.addEventListener('submit', storeBook);
                // search book
                searchBook.addEventListener('keyup', (e) => {
                        searchBook(e.target.value);
                    }),
                    // filter book
                    filterBook.addEventListener('change', (e) => {
                        filterBook(e.target.checked);
                    }),
                    // show book list
                    document.addEventListener('bookChanged', storeLocalStorage);
            }));
        })();
    </script>
</body>

</html>