<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Bookshelf App</title>
</head>

<body>
    <header class="text-center py-3 bg-light">
        <h2>Bookshelf</h2>
    </header>
    <section class="container my-3">
        <div class="row justify-content-between">
            <div class="col-6 col-sm-auto">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">
                    Tambah Buku
                </button>
            </div>
            <div class="col-6 col-sm-auto">
                <form class="d-flex" role="search" id="searchBook">
                    <input id="searchBookTitle" class="form-control me-2" type="search" placeholder="Cari judul buku"
                        aria-label="Search">
                    <button id="searchSubmit" class="btn btn-outline-success" type="submit">Cari</button>
                </form>
            </div>
        </div>
    </section>

    <section class="container">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="row mb-3 align-items-center justify-content-between">
                            <div class="col-6 col-sm-auto">
                                <h3>Rak Buku</h3>
                            </div>
                            <div class="col-6 col-sm-auto">
                                <div class="form-floating">
                                    <select class="form-select" id="filterBook">
                                        <option value="" selected>Semua</option>
                                        <option value="false">Belum Dibaca</option>
                                        <option value="true">Selesai Dibaca</option>
                                    </select>
                                    <label for="filterBook">Filter Buku</label>
                                </div>
                            </div>
                        </div>
                        <!-- Rak Buku -->
                        <div class="row g-3" id="bookList">
                            <div class="book-item col-12 col-sm-6 col-md-4 col-lg-3" data-book-id="">
                                <div class="card">
                                    <div class="card-body shadow">
                                        <div class="dropdown float-end">
                                            <button type="button" class="btn p-0 border-0" data-bs-toggle="dropdown"
                                                aria-expanded="false">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    style="fill: rgba(0, 0, 0, 1);">
                                                    <path
                                                        d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z">
                                                    </path>
                                                </svg>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end text-end">
                                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal"
                                                        data-bs-target="#editModal">Ubah Buku</a></li>
                                                <li><a class="dropdown-item text-danger" href="#">Hapus Buku</a></li>
                                            </ul>
                                        </div>
                                        <div class="form-check form-switch d-flex mb-2">
                                            <input class="form-check-input" type="checkbox" role="switch"
                                                id="isComplete">
                                            <label class="badge bg-warning ms-2 rounded-4" for="isComplete">Belum
                                                Dibaca</label>
                                        </div>
                                        <h4>Laskar Pelangi</h4>
                                        <p class="mb-0">Penulis: Andrea Hirate</p>
                                        <p class="mb-0">Tahun: 2012</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Add Book -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addModalLabel">Masukkan Buku Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="inputBook">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="inputBookTitle" placeholder="Nama Buku"
                                required>
                            <label for="inputBookTitle">Judul</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="inputBookAuthor" placeholder="Nama Penulis"
                                required>
                            <label for="inputBookAuthor">Penulis</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="inputBookYear" placeholder="Tahun Buku Keluar"
                                required>
                            <label for="inputBookYear">Tahun</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="inputBookIsComplete">
                            <label class="form-check-label" for="inputBookIsComplete">
                                Buku Selesai Dibaca
                            </label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mt-3">Simpan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edit Book -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Ubah Buku</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editBook">
                        <input type="hidden" id="editBookId">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="editBookTitle" placeholder="Nama Buku" required>
                            <label for="editBookTitle">Judul</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="editBookAuthor" placeholder="Nama Penulis"
                                required>
                            <label for="editBookAuthor">Penulis</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="editBookYear" placeholder="Tahun Buku Keluar"
                                required>
                            <label for="editBookYear">Tahun</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editBookIsComplete">
                            <label class="form-check-label" for="editBookIsComplete">
                                Buku Selesai Dibaca
                            </label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mt-3">Simpan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let books = [];

        const bookCardHTML = (book) =>
            `
                <div class="card">
                    <div class="card-body shadow">
                        <div class="dropdown float-end">
                            <button type="button" class="btn p-0 border-0" data-bs-toggle="dropdown" aria-expanded="false">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill: rgba(0, 0, 0, 1);"><path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end text-end">
                                <li><a class="edit-book dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editModal">Ubah Buku</a></li>
                                <li><a class="delete-book dropdown-item text-danger" href="#">Hapus Buku</a></li>
                            </ul>
                        </div>
                        <div class="form-check form-switch d-flex mb-2">
                            <input class="form-check-input" type="checkbox" role="switch" id="isComplete" ${book.isComplete ? "checked" : ""}>
                            <label class="badge ms-2 rounded-4 ${book.isComplete ? "bg-success" : "bg-warning"}" for="isComplete">${book.isComplete ? "Sudah Dibaca" : "Belum Dibaca"}</label>
                        </div>
                        <h4>${book.title}</h4>
                        <p class="mb-0">Penulis: ${book.author}</p>
                        <p class="mb-0">Tahun: ${book.year}</p>
                    </div>
                </div>
            `;

        function renderBooks(items) {
            const bookList = document.getElementById('bookList');
            bookList.innerHTML = '';
            items.forEach(book => {
                const bookItem = document.createElement('div');
                bookItem.className = 'book-item col-12 col-sm-6 col-md-4 col-lg-3';
                bookItem.setAttribute('data-book-id', book.id);
                bookItem.innerHTML = bookCardHTML(book);
                bookList.appendChild(bookItem);
            });
        }

        function addBook(e) {
            e.preventDefault();
            const title = document.getElementById('inputBookTitle'),
                author = document.getElementById('inputBookAuthor'),
                year = document.getElementById('inputBookYear'),
                isComplete = document.getElementById('inputBookIsComplete'),
                book = {
                    id: +new Date(),
                    title: title.value,
                    author: author.value,
                    year: parseInt(year.value),
                    isComplete: isComplete.checked
                };
            books.push(book);
            [title.value, author.value, year.value, isComplete.checked] = ['', '', '', false];
            document.dispatchEvent(new Event('bookChanged'));
            console.log(books);
        }

        function editBook(e) {
            e.preventDefault();
            const id = e.target.closest('.book-item').getAttribute('data-book-id'),
                bookId = document.getElementById('editBookId'),
                title = document.getElementById('editBookTitle'),
                author = document.getElementById('editBookAuthor'),
                year = document.getElementById('editBookYear'),
                isComplete = document.getElementById('editBookIsComplete'),
                book = books.find(book => book.id === parseInt(id));
            [bookId.value, title.value, author.value, year.value, isComplete.checked] = [book.id, book.title, book
                .author, book.year, book.isComplete
            ];
            console.log(books);
        }

        function updateBook(e) {
            e.preventDefault();
            const id = document.getElementById('editBookId'),
                title = document.getElementById('editBookTitle'),
                author = document.getElementById('editBookAuthor'),
                year = document.getElementById('editBookYear'),
                isComplete = document.getElementById('editBookIsComplete');
            books.map(book => {
                if (book.id === parseInt(id.value)) {
                    book.title = title.value;
                    book.author = author.value;
                    book.year = parseInt(year.value);
                    book.isComplete = isComplete.checked;
                }
            });
            document.dispatchEvent(new Event('bookChanged'));
            console.log(books);
        }

        function deleteBook(e) {
            e.preventDefault();
            const id = e.target.closest('.book-item').getAttribute('data-book-id'),
                book = books.find(book => book.id === parseInt(id));
            books.splice(books.indexOf(book), 1);
            document.dispatchEvent(new Event('bookChanged'));
            console.log(books);
        }

        function toggleBook(e) {
            e.preventDefault();
            const id = e.target.closest('.book-item').getAttribute('data-book-id'),
                book = books.find(book => book.id === parseInt(id));
            book.isComplete = !book.isComplete;
            document.dispatchEvent(new Event('bookChanged'));
            console.log(books);
        }

        function filterBooks() {
            const filter = document.getElementById('filterBook').value;
            const filteredBooks = books.filter(book => {
                if (book.isComplete.toString() === filter || filter === '') {
                    return true;
                } else {
                    return false;
                }
            });
            console.log(filteredBooks);
            renderBooks(filteredBooks);
        }

        function searchBooks(e) {
            e.preventDefault();
            const search = document.getElementById('searchBookTitle').value;
            const searchedBooks = books.filter(book => {
                if (book.title.toLowerCase().includes(search.toLowerCase()) || search === '') {
                    return true;
                } else {
                    return false;
                }
            });
            console.log(searchedBooks);
            renderBooks(searchedBooks);
        }

        window.addEventListener('load', function () {
            const editModal = new bootstrap.Modal("#editModal");
            const addModal = new bootstrap.Modal("#addModal");
            const input = document.getElementById('inputBook'),
                edit = document.getElementById('editBook'),
                search = document.getElementById('searchBook'),
                filter = document.getElementById('filterBook'),
                bookList = document.getElementById('bookList');
            input.addEventListener('submit', (e) => {
                addBook(e);
                addModal.hide();
            });
            edit.addEventListener('submit', (e) => {
                updateBook(e);
                editModal.hide();
            });
            filter.addEventListener('change', filterBooks);
            search.addEventListener('submit', searchBooks);
            bookList.addEventListener('click', function (e) {
                if (e.target.classList.contains('edit-book')) {
                    editBook(e);
                } else if (e.target.classList.contains('delete-book')) {
                    deleteBook(e);
                } else if (e.target.classList.contains('form-check-input')) {
                    toggleBook(e);
                }
            });
            // bookchanged default with filter
            document.addEventListener('bookChanged', filterBooks);
        });
    </script>
</body>

</html>